<Window x:Class="PdfHandler.UI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="PDFãƒãƒ³ãƒ‰ãƒ©" Height="700" Width="1200"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <!-- ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« -->
        <Style x:Key="ToolbarButtonStyle" TargetType="Button">
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#CCCCCC"/>
        </Style>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ -->
        <Menu Grid.Row="0">
            <MenuItem Header="ãƒ•ã‚¡ã‚¤ãƒ«(_F)">
                <MenuItem Header="ãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ã(_O)..." Command="{Binding OpenFolderCommand}"/>
                <MenuItem Header="æ›´æ–°(_R)" Command="{Binding RefreshCommand}"/>
                <Separator/>
                <MenuItem Header="çµ‚äº†(_X)" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="ç·¨é›†(_E)">
                <MenuItem Header="å‰Šé™¤(_D)" Click="DeleteFiles_Click" InputGestureText="Delete"/>
                <Separator/>
                <MenuItem Header="ã™ã¹ã¦é¸æŠž(_A)" InputGestureText="Ctrl+A"/>
            </MenuItem>
            <MenuItem Header="è¡¨ç¤º(_V)">
                <MenuItem Header="ã‚µãƒ ãƒã‚¤ãƒ«ãƒ“ãƒ¥ãƒ¼(_T)" Command="{Binding ToggleViewCommand}" 
                          IsChecked="{Binding IsThumbnailView}"/>
                <MenuItem Header="ãƒªã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼(_L)" Command="{Binding ToggleViewCommand}"
                          IsChecked="{Binding IsThumbnailView, Converter={StaticResource InverseBoolConverter}}"/>
                <Separator/>
                <MenuItem Header="ã‚µãƒ ãƒã‚¤ãƒ«ã‚µã‚¤ã‚º(_Z)">
                    <MenuItem Header="å°(_S)" Command="{Binding SetThumbnailSizeCommand}" CommandParameter="Small"
                              IsChecked="{Binding IsSmallThumbnail}"/>
                    <MenuItem Header="ä¸­(_M)" Command="{Binding SetThumbnailSizeCommand}" CommandParameter="Medium"
                              IsChecked="{Binding IsMediumThumbnail}"/>
                    <MenuItem Header="å¤§(_L)" Command="{Binding SetThumbnailSizeCommand}" CommandParameter="Large"
                              IsChecked="{Binding IsLargeThumbnail}"/>
                    <MenuItem Header="ç‰¹å¤§(_X)" Command="{Binding SetThumbnailSizeCommand}" CommandParameter="ExtraLarge"
                              IsChecked="{Binding IsExtraLargeThumbnail}"/>
                </MenuItem>
                <Separator/>
                <MenuItem Header="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º(_P)" Command="{Binding TogglePreviewCommand}"
                          IsChecked="{Binding IsPreviewVisible}"/>
            </MenuItem>
            <MenuItem Header="ãƒ„ãƒ¼ãƒ«(_T)">
                <MenuItem Header="PDFã‚’çµåˆ(_M)..." Click="MergePdfs_Click" InputGestureText="Ctrl+M"/>
                <MenuItem Header="PDFã‚’åˆ†å‰²(_S)..." Command="{Binding SplitPdfCommand}"/>
            </MenuItem>
            <MenuItem Header="ãƒ˜ãƒ«ãƒ—(_H)">
                <MenuItem Header="å–æ‰±èª¬æ˜Žæ›¸(_M)" Click="ShowUserManual_Click" InputGestureText="F1"/>
                <Separator/>
                <MenuItem Header="ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±(_A)" Click="About_Click"/>
            </MenuItem>
        </Menu>

        <!-- ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
        <ToolBar Grid.Row="1" Height="40">
            <Button Content="ðŸ”„ æ›´æ–°" Command="{Binding RefreshCommand}" Style="{StaticResource ToolbarButtonStyle}" ToolTip="ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’æ›´æ–°"/>
            <Button Content="ðŸ“ é–‹ã" Command="{Binding OpenFolderCommand}" Style="{StaticResource ToolbarButtonStyle}" ToolTip="ãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ã"/>
            <Button Content="ðŸ—‘ï¸ å‰Šé™¤" Click="DeleteFiles_Click" Style="{StaticResource ToolbarButtonStyle}" ToolTip="é¸æŠžã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ï¼ˆè¤‡æ•°é¸æŠžå¯ï¼‰"/>
            <Separator/>
            <Button Content="ðŸ”— çµåˆ" Click="MergePdfs_Click" Style="{StaticResource ToolbarButtonStyle}" ToolTip="è¤‡æ•°ã®PDFã‚’çµåˆï¼ˆCtrl+ã‚¯ãƒªãƒƒã‚¯ã§è¤‡æ•°é¸æŠžï¼‰"/>
            <Button Content="âœ‚ï¸ åˆ†å‰²" Command="{Binding SplitPdfCommand}" Style="{StaticResource ToolbarButtonStyle}" ToolTip="PDFã‚’åˆ†å‰²"/>
            <Separator/>
            <Button Content="ðŸ–¼ï¸ ã‚µãƒ ãƒã‚¤ãƒ«" Command="{Binding ToggleViewCommand}" Style="{StaticResource ToolbarButtonStyle}" ToolTip="ã‚µãƒ ãƒã‚¤ãƒ«/ãƒªã‚¹ãƒˆè¡¨ç¤ºåˆ‡æ›¿"/>
            <Button Content="ðŸ‘ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" Command="{Binding TogglePreviewCommand}" Style="{StaticResource ToolbarButtonStyle}" ToolTip="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºON/OFF"/>
            <Separator/>
            <TextBlock Text="ðŸ’¡ F2ã‚­ãƒ¼ã§ãƒ•ã‚¡ã‚¤ãƒ«åå¤‰æ›´" VerticalAlignment="Center" Margin="10,0,0,0" Foreground="Gray" FontSize="11"/>
        </ToolBar>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ï¼ˆ3ãƒšã‚¤ãƒ³æ§‹æˆï¼‰ -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250" MinWidth="150"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="400" MinWidth="300"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*" MinWidth="200"/>
            </Grid.ColumnDefinitions>

            <!-- å·¦ãƒšã‚¤ãƒ³: ãƒ•ã‚©ãƒ«ãƒ€ãƒ„ãƒªãƒ¼ï¼†ãŠæ°—ã«å…¥ã‚Š -->
            <Border Grid.Column="0" BorderBrush="#CCCCCC" BorderThickness="1" Margin="5">
                <TabControl>
                    <!-- ãƒ•ã‚©ãƒ«ãƒ€ãƒ„ãƒªãƒ¼ã‚¿ãƒ– -->
                    <TabItem Header="ðŸ“ ãƒ•ã‚©ãƒ«ãƒ€">
                        <TreeView x:Name="FolderTreeView"
                                  SelectedItemChanged="TreeView_SelectedItemChanged">
                            <TreeView.ItemTemplate>
                                <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="ðŸ“ " FontSize="14"/>
                                        <TextBlock Text="{Binding Name}" FontSize="12"/>
                                    </StackPanel>
                                </HierarchicalDataTemplate>
                            </TreeView.ItemTemplate>
                        </TreeView>
                    </TabItem>
                    
                    <!-- ãŠæ°—ã«å…¥ã‚Šã‚¿ãƒ– -->
                    <TabItem Header="â­ ãŠæ°—ã«å…¥ã‚Š">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <!-- ãŠæ°—ã«å…¥ã‚Šæ“ä½œãƒœã‚¿ãƒ³ -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                                <Button Content="âž• è¿½åŠ " Command="{Binding AddFavoriteCommand}" 
                                        Padding="5,2" Margin="0,0,5,0" 
                                        ToolTip="ç¾åœ¨ã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ "/>
                            </StackPanel>
                            
                            <!-- ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆ -->
                            <ListBox Grid.Row="1" ItemsSource="{Binding Favorites}" 
                                     Margin="5,0,5,5">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="2">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <!-- ãŠæ°—ã«å…¥ã‚Šåï¼ˆã‚¯ãƒªãƒƒã‚¯ã§é–‹ãï¼‰ -->
                                            <Button Grid.Column="0" 
                                                    Content="{Binding Name}"
                                                    Command="{Binding DataContext.OpenFavoriteCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                    CommandParameter="{Binding}"
                                                    HorizontalContentAlignment="Left"
                                                    Background="Transparent"
                                                    BorderThickness="0"
                                                    Padding="5,2"
                                                    ToolTip="{Binding Path}"/>
                                            
                                            <!-- å‰Šé™¤ãƒœã‚¿ãƒ³ -->
                                            <Button Grid.Column="1" 
                                                    Content="âŒ"
                                                    Command="{Binding DataContext.RemoveFavoriteCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                    CommandParameter="{Binding}"
                                                    Background="Transparent"
                                                    BorderThickness="0"
                                                    Padding="2"
                                                    ToolTip="å‰Šé™¤"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Grid>
                    </TabItem>
                </TabControl>
            </Border>

            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="#E0E0E0"/>

            <!-- ä¸­å¤®ãƒšã‚¤ãƒ³: ã‚µãƒ ãƒã‚¤ãƒ«/ãƒªã‚¹ãƒˆ -->
            <Border Grid.Column="2" BorderBrush="#CCCCCC" BorderThickness="1" Margin="5,5,0,5">
                <Grid>
                    <!-- ã‚µãƒ ãƒã‚¤ãƒ«ãƒ“ãƒ¥ãƒ¼ -->
                    <ListView x:Name="ThumbnailListView"
                              ItemsSource="{Binding PdfFiles}" 
                              SelectedItem="{Binding SelectedPdfFile}"
                              SelectionMode="Extended"
                              KeyDown="FileListView_KeyDown"
                              MouseDoubleClick="ThumbnailItem_DoubleClick"
                              ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                              Visibility="{Binding IsThumbnailView, Converter={StaticResource BoolToVisibilityConverter}}">
                        <ListView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ListView.ItemsPanel>
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Width="{Binding DataContext.ThumbnailWidth, RelativeSource={RelativeSource AncestorType=ListView}}" 
                                            Margin="5">
                                    <Border BorderBrush="#CCCCCC" BorderThickness="1" 
                                            Height="{Binding DataContext.ThumbnailHeight, RelativeSource={RelativeSource AncestorType=ListView}}" 
                                            Background="White">
                                        <Image Source="{Binding ThumbnailData, Converter={StaticResource ByteArrayToImageConverter}}" 
                                               Stretch="Uniform"/>
                                    </Border>
                                    
                                    <!-- ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆç·¨é›†å¯èƒ½ï¼‰ -->
                                    <Grid Margin="0,5,0,0">
                                        <!-- é€šå¸¸è¡¨ç¤º -->
                                        <TextBlock Text="{Binding FileName}" 
                                                   TextWrapping="Wrap" 
                                                   FontSize="12" 
                                                   HorizontalAlignment="Center"
                                                   Visibility="{Binding IsEditing, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                                        
                                        <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ -->
                                        <TextBox Text="{Binding EditingName, UpdateSourceTrigger=PropertyChanged}"
                                                 FontSize="12"
                                                 HorizontalAlignment="Stretch"
                                                 Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibilityConverter}}"
                                                 LostFocus="FileNameEdit_LostFocus"
                                                 KeyDown="FileNameEdit_KeyDown"
                                                 Loaded="FileNameEdit_Loaded"/>
                                    </Grid>
                                    
                                    <TextBlock Text="{Binding FormattedFileSize}" 
                                               FontSize="11" 
                                               Foreground="Gray"
                                               HorizontalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                    <!-- ãƒªã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼ -->
                    <ListView x:Name="FileListView"
                              ItemsSource="{Binding PdfFiles}"
                              SelectedItem="{Binding SelectedPdfFile}"
                              SelectionMode="Extended"
                              KeyDown="FileListView_KeyDown"
                              Visibility="{Binding IsThumbnailView, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="ãƒ•ã‚¡ã‚¤ãƒ«å" Width="250">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Grid>
                                                <!-- é€šå¸¸è¡¨ç¤º -->
                                                <TextBlock Text="{Binding FileName}" 
                                                           Visibility="{Binding IsEditing, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                                           MouseLeftButtonDown="FileName_DoubleClick"/>
                                                
                                                <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ -->
                                                <TextBox Text="{Binding EditingName, UpdateSourceTrigger=PropertyChanged}"
                                                         Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibilityConverter}}"
                                                         LostFocus="FileNameEdit_LostFocus"
                                                         KeyDown="FileNameEdit_KeyDown"
                                                         Loaded="FileNameEdit_Loaded"/>
                                            </Grid>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="ã‚µã‚¤ã‚º" Width="100" DisplayMemberBinding="{Binding FormattedFileSize}"/>
                                <GridViewColumn Header="æ›´æ–°æ—¥æ™‚" Width="150" DisplayMemberBinding="{Binding LastModified, StringFormat=yyyy/MM/dd HH:mm}"/>
                                <GridViewColumn Header="ãƒšãƒ¼ã‚¸æ•°" Width="80" DisplayMemberBinding="{Binding PageCount}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Grid>
            </Border>

            <GridSplitter Grid.Column="3" Width="5" HorizontalAlignment="Stretch" Background="#E0E0E0"/>

            <!-- å³ãƒšã‚¤ãƒ³: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
            <Border Grid.Column="4" 
                    BorderBrush="#CCCCCC" 
                    BorderThickness="1" 
                    Margin="0,5,5,5"
                    Visibility="{Binding IsPreviewVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Background="#F0F0F0" Height="35">
                        <Button Content="ðŸ”-" Margin="5" Padding="5" Command="{Binding ZoomOutCommand}"/>
                        <TextBlock Text="{Binding ZoomPercent, StringFormat={}{0}%}" VerticalAlignment="Center" Margin="5" MinWidth="40"/>
                        <Button Content="ðŸ”+" Margin="5" Padding="5" Command="{Binding ZoomInCommand}"/>
                        <Separator/>
                        <Button Content="â—€ï¸" Margin="5" Padding="5" Command="{Binding PreviousPageCommand}"/>
                        <TextBlock VerticalAlignment="Center" Margin="5" MinWidth="50">
                            <Run Text="{Binding CurrentPageNumber}"/><Run Text="/"/><Run Text="{Binding TotalPages}"/>
                        </TextBlock>
                        <Button Content="â–¶ï¸" Margin="5" Padding="5" Command="{Binding NextPageCommand}"/>
                    </StackPanel>

                    <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                    <Border Grid.Row="1" Background="White">
                        <ScrollViewer x:Name="PreviewScrollViewer" 
                                      HorizontalScrollBarVisibility="Auto" 
                                      VerticalScrollBarVisibility="Auto">
                            <Image x:Name="PreviewImage" 
                                   Source="{Binding PreviewImageData, Converter={StaticResource ByteArrayToImageConverter}}"
                                   Stretch="None"
                                   RenderOptions.BitmapScalingMode="HighQuality"/>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ -->
        <StatusBar Grid.Row="3" Height="25" Background="#F0F0F0">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusText}"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Text="{Binding PdfFiles.Count, StringFormat='{}{0}é …ç›®'}"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Text="{Binding IsPreviewVisible, StringFormat='ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼: {0}'}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
